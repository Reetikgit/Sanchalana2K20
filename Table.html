<!DOCTYPE html>
<html lang="en">
<head></head>
<meta charset="utf-8">
<title>TableDisp</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="css/base.css">
   <link rel="stylesheet" href="css/vendor.min.css">
   <link rel="stylesheet" href="css/main.css">  
   <script src="js/modernizr.js"></script>
   <link rel="stylesheet" href="cssP/style.css">
     <link href='https://fonts.googleapis.com/css?family=Permanent+Marker:400' rel='stylesheet' type='text/css'>
<style>
    form{
        margin: 20px 0;
    }
    form input, button{
        padding: 5px;
    }
    table{
        width: 100%;
        margin-bottom: 20px;
		border-collapse: collapse;
    }
    table, th, td{
        border: 1px solid #cdcdcd;
    }
    table th, table td{
        padding: 10px;
        text-align: left;
    }
</style>
<body>
    <br>
    <br>
<div class="w3-content">
<div class="form-group" id="registrationform">
      <h2 class="animate-this" data-animate="fadeInRight">Select Event&nbsp;&nbsp;&nbsp;&nbsp;</h2>
<div class="form-wrapper">
  
        <div  id="tableform">
            <select  name="service" class="form-control" id="name" style="color:orange">
              <option>Solo Dance</option>
              <option>Solo Singing</option>
              <option>Instrumental</option>
              <option>Painting</option>
              <option>Gaming</option>
              <option>Slow Drag</option>
              <option>Super minute</option>
            </select>
          </div>
          <!-- <span class="focus-input100"></span> -->
        
     <button type="submit" onclick="gotDatas()" >Search</button>

    </div>
    <button id="csv" style="background-color: green;visibility: hidden;" onclick="exportTableToCSV('ParticipationList.csv')">Download exel File</button>
</div>
</div>

    <table  style="background-color: white;">
        <thead >
            <tr  >
                <th>Count</th>
                <th>Name</th>
                <th>Usn</th>
                <th>Phone</th>
                <th>Branch</th>
                <th>Payment</th>
            </tr>
        </thead>
        <tbody id="myTable">
          
        </tbody>
    </table>

</body> 
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.10.0/firebase.js"></script>
<script type="text/javascript">

  var firebaseConfig = {
    apiKey: "AIzaSyB_5vqcnQ7sD2AsHeBRl2QB6GifZmp8jGM",
    authDomain: "contactform-673b7.firebaseapp.com",
    databaseURL: "https://contactform-673b7.firebaseio.com",
    projectId: "contactform-673b7",
    storageBucket: "",
    messagingSenderId: "172917494368",
    appId: "1:172917494368:web:1cc301177c4f4fd6a46905",
    measurementId: "G-N5BDJDDC63"

  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

  
//Reference for form collection(3)
// let formMessage = firebase.database().ref('register');
// let formMessage = firebase.database().ref('/');


  
   database=firebase.database();
  var ref=database.ref('common');
 // var keys;
  ref.on('value',gotData,errData);
   var initials;
   var count;
   var match=0,usnD,sc;
   var keys;
   var len=0;
   var amt;
    // document.getElementById('myTable').deleteRow();
  // document
  // .getElementById('tableform')
  // .addEventListener('submit', gotData);
  // var btn=document.getElementById('reset');
  // btn.addEventListener("click",updateData)
  function gotData(data)
  {

     sc=data.val();
   
     keys=Object.keys(sc);
    
    }
    // function gotData2(data)
    // {

    //  sc=data.val();
   
    //  keys2=Object.keys(sc);
   
    
    // }
    var random;
    function gotDatas()
    {
    var p = document.getElementById('myTable');
   
    
     let eventname = document.querySelector('#name').value;

   
  //send message values
  // sendMessage(name, usn, email,event, phn, branch, sem, random);

  
  /*Fetching the elements from each object*/
 
  
    // $(document).ready(function(){
    //     $(".add-row").click(function(){
    //         var event = $("#name").val();
    var count=0;
        $('#myTable').empty();
    for(var i=0;i<keys.length;i++)
    {
    
      
      var k=keys[i];

      var names=sc[k].name;
      var phone=sc[k].phn;
      var branch=sc[k].branch;

      var usn=sc[k].usn;
      var event=sc[k].event;
      var payment=sc[k].Payment;
     
      if(event==eventname && payment!="no")
      {
   
        count++;
         document.getElementById("csv").style.visibility ="visible";
        var markup = "<tr><td>"+count+"</td><td>" + names + "</td><td>" + usn + "</td><td>" + phone + "</td><td>" + branch + "</td><td>" + payment + "</td></tr>";
         $("table tbody").append(markup);


      }
    }
    
    }
      
 function errData(err)
  {
    console.log('error');
    console.log(err);
  }

        // Find and remove selected table rows
    //     $(".delete-row").click(function(){
    //         $("table tbody").find('input[name="record"]').each(function(){
    //         	if($(this).is(":checked")){
    //                 $(this).parents("tr").remove();
    //             }
    //         });
    //     });
    // }); 
    function downloadCSV(csv, filename) {
    var csvFile;
    var downloadLink;

    // CSV file
    csvFile = new Blob([csv], {type: "text/csv"});

    // Download link
    downloadLink = document.createElement("a");

    // File name
    downloadLink.download = filename;

    // Create a link to the file
    downloadLink.href = window.URL.createObjectURL(csvFile);

    // Hide download link
    downloadLink.style.display = "none";

    // Add the link to DOM
    document.body.appendChild(downloadLink);

    // Click download link
    downloadLink.click();
}
function exportTableToCSV(filename) {
    var csv = [];
    var rows = document.querySelectorAll("table tr");
    
    for (var i = 0; i < rows.length; i++) {
        var row = [], cols = rows[i].querySelectorAll("td, th");
        
        for (var j = 0; j < cols.length; j++) 
            row.push(cols[j].innerText);
        
        csv.push(row.join(","));        
    }

    // Download CSV file
    downloadCSV(csv.join("\n"), filename);
}

</script>


</html>                            